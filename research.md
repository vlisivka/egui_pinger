# Дослідження: Підтримка IPv6 у egui_pinger

**Тема**: Аналіз причин відсутності підтримки IPv6 та пошук альтернатив для `surge-ping`.

## Мета
Користувачі повідомляють про неможливість використання IPv6 адрес. Необхідно з'ясувати технічні причини та запропонувати шляхи вирішення для забезпечення повноцінної роботи програми з протоколом IPv6.

## Аналіз поточної реалізації

1.  **Бібліотека `surge-ping`**: Проєкт використовує `surge-ping` версії 0.8. Згідно з офіційною документацією (crates.io/github), ця бібліотека **не має повної підтримки IPv6**. Пряма цитата розробника: *"IPv6 is not fully implemented. If you have a need for IPv6, you can submit a PR and build together."*
2.  **Формування запитів у `src/logic/pinger.rs`**:
    -   Код намагається розпарсити адресу як `IpAddr`. Якщо це IPv6, ми отримуємо `IpAddr::V6`.
    -   При передачі `IpAddr::V6` у функцію `surge_ping::ping()`, вона, ймовірно, повертає помилку через внутрішні обмеження бібліотеки.
    -   Додатково, `format!("{}:0", address)` для `lookup_host` може працювати некоректно для IPv6 без квадратних дужок (наприклад, `2001:db8::1:0` є неоднозначним), хоча тести показали, що в деяких випадках `tokio` це обробляє. Однак, якщо адреса вже є IP, цей блок коду не виконується.

## Опис варіантів вирішення

### Варіант 1: Перехід на `ping-async` (Рекомендовано)
`ping-async` — сучасна бібліотека, розроблена спеціально для асинхронного пінгу з підтримкою IPv4 та IPv6 на різних платформах.

*   **Переваги**:
    -   Повна підтримка IPv6.
    -   Кросплатформеність: на Windows використовує нативні `IcmpSendEcho2Ex` та `Icmp6SendEcho2` (що не потребує прав адміністратора), на Linux — ICMP сокети.
    -   Активно оновлюється (останній реліз у лютому 2026 року).
*   **Недоліки**:
    -   Трохи інший API у порівнянні з `surge-ping`. Потрібно створити один екземпляр `IcmpEchoRequestor` та використовувати його для запитів.

### Варіант 2: Перехід на `tokio-icmp-echo`
Форк `tokio-ping`, адаптований для сучасного екосистеми Tokio.

*   **Переваги**:
    -   Підтримка IPv4 та IPv6.
    -   Більш стабільний API.
*   **Недоліки**:
    -   Явно вимагає підвищених привілеїв (root/admin) для роботи з ICMP сокетами за замовчуванням.
    -   Менш активна розробка у порівнянні з `ping-async`.

### Варіант 3: Очікування оновлення `surge-ping`
Залишити все як є та чекати, поки розробник реалізує IPv6.

*   **Недоліки**: Проблема існує вже тривалий час, і шанси на швидке вирішення силами автора низькі.

## Рекомендації

Найкращим варіантом є перехід на бібліотеку **`ping-async`**. Вона дозволить не лише додати підтримку IPv6, а й покращити роботу на Windows без потреби в правах адміністратора для пінгу.

## Вплив на проєкт

Для реалізації змін буде задіяно такі файли:
-   `Cargo.toml`: видалення `surge-ping`, додавання `ping-async`.
-   `src/logic/pinger.rs`: рефакторинг методу `pinger_task` для використання `IcmpEchoRequestor`.
-   `tests/`: оновлення тестів для перевірки IPv6 пінгу (можна додати інтеграційний тест з `2001:4860:4860::8888`).
